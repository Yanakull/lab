---
## Front matter
title: "Отчёт по лабораторной работе №16"
subtitle: "Программный RAID"
author: "Руслан Алиев"

## Generic otions
lang: ru-RU
toc-title: "Содержание"

## Bibliography
bibliography: bib/cite.bib
csl: pandoc/csl/gost-r-7-0-5-2008-numeric.csl

## Pdf output format
toc: true
toc-depth: 2
lof: true
lot: true
fontsize: 12pt
linestretch: 1.5
papersize: a4
documentclass: scrreprt
## I18n polyglossia
polyglossia-lang:
  name: russian
  options:
    - spelling=modern
    - babelshorthands=true
polyglossia-otherlangs:
  name: english
## I18n babel
babel-lang: russian
babel-otherlangs: english
## Fonts
mainfont: IBM Plex Serif
romanfont: IBM Plex Serif
sansfont: IBM Plex Sans
monofont: IBM Plex Mono
mathfont: STIX Two Math
mainfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
romanfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
sansfontoptions: Ligatures=Common,Ligatures=TeX,Scale=MatchLowercase,Scale=0.94
monofontoptions: Scale=MatchLowercase,Scale=0.94,FakeStretch=0.9
mathfontoptions:
## Biblatex
biblatex: true
biblio-style: "gost-numeric"
biblatexoptions:
  - parentracker=true
  - backend=biber
  - hyperref=auto
  - language=auto
  - autolang=other*
  - citestyle=gost-numeric
## Pandoc-crossref LaTeX customization
figureTitle: "Рис."
tableTitle: "Таблица"
listingTitle: "Листинг"
lofTitle: "Список иллюстраций"
lotTitle: "Список таблиц"
lolTitle: "Листинги"
## Misc options
indent: true
header-includes:
  - \usepackage{indentfirst}
  - \usepackage{float}
  - \floatplacement{figure}{H}
---

# Цель работы

Освоить работу с RAID-массивами при помощи утилиты mdadm.

# Выполнение

## Создание RAID-диска

1. Виртуальная машина запущена, получены полномочия администратора командой su -. Далее выполнена проверка наличия дополнительных дисков через fdisk -l | grep /dev/sd. В системе обнаружены устройства /dev/sdd, /dev/sde и /dev/sdf, подготовленные на предыдущем этапе.

   ![Проверка дисков /dev/sdd, /dev/sde, /dev/sdf](Screenshot_1.png){ #fig:001 width=80% }

2. На каждом из обнаруженных дисков созданы разделы с помощью утилиты sfdisk. На устройствах /dev/sdd, /dev/sde и /dev/sdf появился по одному разделу, занимающему весь объём диска.

   ![Создание разделов на дисках](Screenshot_2.png){ #fig:002 width=80% }

3. Тип созданных разделов проверен с помощью sfdisk --print-id. Для всех разделов (/dev/sdd1, /dev/sde1, /dev/sdf1) зафиксирован тип 83 (Linux).

4. Просмотрен список RAID-типов, доступных в sfdisk. Обнаружен тип fd, соответствующий Linux raid autodetect.

5. Тип созданных разделов изменён на RAID-совместимый: fd (Linux raid autodetect). Изменения применены для всех трёх дисков.

   ![Изменение типа разделов на RAID](Screenshot_3.png){ #fig:005 width=80% }

6. Текущее состояние дисков просмотрено через sfdisk -l. На всех устройствах присутствует один раздел размером около 511 MiB, имеющий тип fd Linux raid autodetect.

   ![Состояние дисков /dev/sde и /dev/sdf](Screenshot_4.png){ #fig:007 width=80% }

7. Утилита mdadm уже установлена в системе, поэтому дополнительных действий не потребовалось.

8. Создан RAID-массив уровня RAID1 из двух устройств: /dev/sdd1 и /dev/sde1. В результате появился массив /dev/md0, который успешно активирован и готов к дальнейшему использованию.

   ![Создание RAID-массива](Screenshot_5.png){ #fig:008 width=80% }

9. Просмотрено состояние массива через /proc/mdstat, mdadm --query и mdadm --detail. Массив имеет уровень raid1, состояние clean, оба устройства активны и работают в режиме active sync.

   ![Информация о RAID](Screenshot_6.png){ #fig:009 width=80% }

10. На массиве /dev/md0 создана файловая система ext4. Форматирование прошло успешно, что подтверждается выводом утилиты.

    ![Создание файловой системы](Screenshot_7.png){ #fig:010 width=80% }

11. Создан каталог /mnt/raid, после чего массив /dev/md0 был подмонтирован в эту точку. Массив стал доступен для чтения и записи.


12. В файл /etc/fstab добавлена запись, обеспечивающая автомонтирование RAID-массива при загрузке системы: /dev/md0 /mnt/raid ext4 defaults 1 2.

    ![/etc/fstab с записью массива](Screenshot_8.png){ #fig:012 width=80% }

13. Для имитации сбоя один из дисков массива (/dev/sde1) был помечен как неисправный. После этого неисправный диск удалён, а на его место добавлен новый — /dev/sdf1. Массив начал процесс синхронизации.

    ![Сбой, удаление и добавление диска](Screenshot_9.png){ #fig:013 width=80% }

14. После замены диска массив снова проверен. Оба активных устройства (/dev/sdd1 и /dev/sdf1) работают в режиме active sync, состояние массива clean, что свидетельствует об успешном восстановлении.

15. В завершение работы массив был размонтирован, остановлен и очищены суперблоки RAID на всех задействованных устройствах (/dev/sdd1, /dev/sde1, /dev/sdf1), что полностью удалило информацию о RAID.

    ![Удаление массива и очистка суперблоков](Screenshot_10.png){ #fig:015 width=80% }

## RAID-массив с горячим резервом (hot spare)

1. Получены полномочия администратора.  
   Система готова к созданию RAID-массива.

2. Создан массив RAID1 из двух дисков /dev/sdd1 и /dev/sde1.  
   Массив /dev/md0 успешно сформирован и активирован.

   ![Создание массива RAID1](Screenshot_11.png){ #fig:016 width=80% }

3. В массив добавлен третий диск /dev/sdf1.  
   Он был определён как диск горячего резерва (spare).

4. Выполнено монтирование /dev/md0.  
   Система уведомила о необходимости перезагрузки systemd для подхвата изменений, однако монтирование прошло успешно.

5. Проверено состояние массива.  
   В выводе видно:  
   – уровень raid1,  
   – два активных устройства /dev/sdd1 и /dev/sde1,  
   – один резервный диск /dev/sdf1 (spare).  
   Массив находится в состоянии clean.

   ![Состояние массива после добавления hot spare](Screenshot_12.png){ #fig:017 width=80% }

6. Выполнена симуляция сбоя диска /dev/sde1.  
   После пометки устройства как faulty массив продолжил работу.

   ![Сбой диска в RAID1](Screenshot_13.png){ #fig:004 width=80% }

7. Проверено состояние массива после сбоя.  
   Диск /dev/sde1 отображается как faulty.  
   Диск /dev/sdf1 автоматически активируется в работу — hot spare заменяет вышедший из строя диск, что подтверждает корректную работу механизма резервирования.

8. Массив удалён, метаданные на всех задействованных разделах очищены.  
   Устройства полностью готовы к повторному использованию.

## Преобразование массива RAID1 в RAID5

1. Получены полномочия администратора.

2. Создан массив RAID1 из двух устройств /dev/sdd1 и /dev/sde1.  
   Массив /dev/md0 успешно создан и активен.

3. Добавлен третий диск /dev/sdf1, который определяется как запасной.

   ![Создание массива и добавление третьего диска](Screenshot_14.png){ #fig:018 width=80% }

4. RAID-массива успешно подмонтирован.

5. Просмотрено его состояние.  
   Уровень raid1, активные диски /dev/sdd1 и /dev/sde1, диск /dev/sdf1 — резервный.

   ![Состояние RAID1 перед конверсией](Screenshot_15.png){ #fig:019 width=80% }
   
6. Тип массива изменён с RAID1 на RAID5.  
   После изменения уровня массив продолжает работу, но по-прежнему использует только два активных диска, один остаётся в резерве.

   ![Изменение уровня массива RAID](Screenshot_16.png){ #fig:020 width=80% }

7. Просмотрено состояние массива.  
   Отмечено:  
   – уровень изменён на raid5,  
   – массив всё ещё использует два активных диска,  
   – /dev/sdf1 остаётся в роли hot spare,  
   – размер массива пока соответствует двухдисковой конфигурации.

8. Количество устройств массива увеличено до трёх.  
   Диск /dev/sdf1 включён в состав массива как рабочий.

9. Состояние массива после расширения:  
   – уровень raid5,  
   – задействованы три активных устройства /dev/sdd1, /dev/sde1, /dev/sdf1,  
   – отказоустойчивость и производительность увеличены,  
   – размер массива вырос примерно вдвое.

   ![Состояние RAID5 с тремя активными дисками](Screenshot_17.png){ #fig:021 width=80% }

10. Массив удалён, суперблоки на всех трёх устройствах очищены.  
    Устройства полностью очищены от признаков RAID.

11. В файле /etc/fstab строка для /dev/md0 закомментирована, чтобы исключить попытки автомонтирования несуществующего массива.

# Контрольные вопросы

1. **Приведите определение RAID.**
   RAID (Redundant Array of Independent Disks) — это технология объединения нескольких физических дисков в единый логический массив с целью повышения отказоустойчивости, производительности или обеих характеристик одновременно.

2. **Какие типы RAID-массивов существуют на сегодняшний день?**
   Существуют следующие основные уровни RAID:
   RAID 0, RAID 1, RAID 5, RAID 6, RAID 10, RAID 50, RAID 60, а также комбинации и проприетарные реализации.
   Также выделяют **hot spare** — резервные диски, автоматически подключаемые при сбое.

3. **Охарактеризуйте RAID 0, RAID 1, RAID 5, RAID 6, опишите алгоритм работы, назначение и примеры применения.**
   **RAID 0** — распределение данных по дискам без избыточности.
   Алгоритм работы: данные разбиваются на блоки и записываются поочерёдно на разные диски (stripping).
   Назначение: максимальное увеличение скорости и объёма, отсутствие отказоустойчивости.
   Применение: временные данные, высокопроизводительные задачи без критичности к потерям (рендеринг, кэширование).

   **RAID 1** — зеркалирование данных.
   Алгоритм работы: каждый блок записывается на два (или более) диска одновременно, создавая полный дубль.
   Назначение: полная отказоустойчивость при сохранении скорости чтения.
   Применение: серверы баз данных, критически важные системы, требующие непрерывной работы.

   **RAID 5** — распределённая четность.
   Алгоритм работы: данные и блоки четности (parity) равномерно распределяются между всеми дисками массива.
   Назначение: баланс между скоростью, надёжностью и эффективностью использования дискового пространства.
   Применение: файловые серверы, корпоративные хранилища с высокой степенью читаемости.

   **RAID 6** — двойная четность.
   Алгоритм работы: хранение двух независимых блоков четности на каждом цикле записи.
   Назначение: обеспечивает сохранность данных при одновременном выходе из строя сразу двух дисков.
   Применение: крупные массивы хранения, где длительное восстановление и вероятность двойного сбоя критичны (архивы, data-центры).


# Заключение

В ходе работы были изучены принципы создания и управления программными RAID-массивами в Linux с использованием утилиты **mdadm**. Было рассмотрено формирование RAID 1, добавление диска горячего резерва, обработка отказов и автоматическое восстановление массива. Также выполнено преобразование RAID 1 в RAID 5 с расширением количества дисков и анализом изменений в его состоянии. Практическая часть позволила освоить процессы настройки отказоустойчивых систем хранения данных, а также понять особенности работы различных уровней RAID и их применение на практике.
